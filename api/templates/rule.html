{% extends 'base.html' %}

{% block content %}
<style>
  #pdf-container {
    width: 100%;
    height: 500px;
    /* Adjust the height as needed */
    overflow: auto;
  }
</style>

<div class="bg-body-tertiary">
  <div class="container py-5">
    <h1 class="display-4">游戏规则</h1>
    <div class="row h-100 align-items-center py-5">
      <p class="text-muted lead">https://docs.google.com/document/d/1nsbWFDwBoQwyLgNq3ujmwrF-_xWQkmPoPpfZEk3mF_s/edit
      </p>

      <div id="pdf-container">
        <canvas id="pdf-canvas"></canvas>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script>
  const pdfCanvas = document.getElementById('pdf-canvas');
  const pdfContainer = document.getElementById('pdf-container');

  let pdfDoc = null;
  let pageNum = 1;
  const scale = 1.5;

  function renderPage(num) {
    pdfDoc.getPage(num).then(page => {
      const viewport = page.getViewport({ scale });
      pdfCanvas.width = viewport.width;
      pdfCanvas.height = viewport.height;

      const context = pdfCanvas.getContext('2d');
      const renderContext = {
        canvasContext: context,
        viewport: viewport
      };

      page.render(renderContext);
    });
  }

  pdfjsLib.getDocument('https://ibb.vercel.app/rules.pdf').promise.then(pdf => {
    pdfDoc = pdf;
    renderPage(pageNum);

    // Listen for scroll events and update page number accordingly
    pdfContainer.addEventListener('scroll', () => {
      const scrollFraction = pdfContainer.scrollTop / (pdfContainer.scrollHeight - pdfContainer.clientHeight);
      const desiredPage = Math.min(Math.ceil(scrollFraction * pdfDoc.numPages), pdfDoc.numPages);
      if (pageNum !== desiredPage) {
        pageNum = desiredPage;
        renderPage(pageNum);
      }
    });
  });

</script>
{% endblock %}